<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- CSRF token for AJAX requests -->
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <title>{% block title %}Programming Course Enrollment{% endblock %}</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">

    <!-- Favicon -->
{#    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">#}

    <!-- Additional CSS -->
    {% block extra_css %}{% endblock %}

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    {% block head %}{% endblock %}
</head>
<body class="h-full bg-gray-50 antialiased" x-data="baseApp()">
    <!-- Main Content Wrapper -->
    <div class="min-h-screen flex flex-col">
        <!-- Main Content Area -->
        <main class="flex-1">
            <!-- Page Container -->
            <div class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mb-8 space-y-3" x-data="flashMessages()" x-init="init()">
                            {% for category, message in messages %}
                                <div class="flex items-center p-4 rounded-lg shadow-sm
                                    {% if category == 'error' %}bg-red-50 border border-red-200{% endif %}
                                    {% if category == 'success' %}bg-green-50 border border-green-200{% endif %}
                                    {% if category == 'warning' %}bg-yellow-50 border border-yellow-200{% endif %}
                                    {% if category == 'info' %}bg-blue-50 border border-blue-200{% endif %}"
                                     x-show="showMessage"
                                     x-transition:enter="transition ease-out duration-300"
                                     x-transition:enter-start="opacity-0 transform scale-95"
                                     x-transition:enter-end="opacity-100 transform scale-100"
                                     x-transition:leave="transition ease-in duration-200"
                                     x-transition:leave-start="opacity-100 transform scale-100"
                                     x-transition:leave-end="opacity-0 transform scale-95">

                                    <!-- Icon -->
                                    <div class="flex-shrink-0">
                                        {% if category == 'error' %}
                                            <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                            </svg>
                                        {% elif category == 'success' %}
                                            <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                            </svg>
                                        {% elif category == 'warning' %}
                                            <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                            </svg>
                                        {% else %}
                                            <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                            </svg>
                                        {% endif %}
                                    </div>

                                    <!-- Message -->
                                    <div class="ml-3 flex-1">
                                        <p class="text-sm font-medium
                                            {% if category == 'error' %}text-red-800{% endif %}
                                            {% if category == 'success' %}text-green-800{% endif %}
                                            {% if category == 'warning' %}text-yellow-800{% endif %}
                                            {% if category == 'info' %}text-blue-800{% endif %}">
                                            {{ message }}
                                        </p>
                                    </div>

                                    <!-- Close Button -->
                                    <div class="ml-auto pl-3">
                                        <button @click="dismissMessage()"
                                                class="inline-flex rounded-md p-1.5 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2
                                                    {% if category == 'error' %}text-red-500 hover:bg-red-100 focus:ring-red-600{% endif %}
                                                    {% if category == 'success' %}text-green-500 hover:bg-green-100 focus:ring-green-600{% endif %}
                                                    {% if category == 'warning' %}text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600{% endif %}
                                                    {% if category == 'info' %}text-blue-500 hover:bg-blue-100 focus:ring-blue-600{% endif %}">
                                            <span class="sr-only">Dismiss</span>
                                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- Dynamic Alert Messages (for AJAX) -->
                <div x-show="alert.show"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100 transform scale-100"
                     x-transition:leave-end="opacity-0 transform scale-95"
                     class="mb-8">
                    <div class="flex items-center p-4 rounded-lg shadow-sm"
                         :class="{
                             'bg-red-50 border border-red-200': alert.type === 'error',
                             'bg-green-50 border border-green-200': alert.type === 'success',
                             'bg-yellow-50 border border-yellow-200': alert.type === 'warning',
                             'bg-blue-50 border border-blue-200': alert.type === 'info'
                         }">

                        <!-- Dynamic Icon -->
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5"
                                 :class="{
                                     'text-red-400': alert.type === 'error',
                                     'text-green-400': alert.type === 'success',
                                     'text-yellow-400': alert.type === 'warning',
                                     'text-blue-400': alert.type === 'info'
                                 }"
                                 fill="currentColor" viewBox="0 0 20 20">
                                <!-- Error Icon -->
                                <path x-show="alert.type === 'error'" fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                <!-- Success Icon -->
                                <path x-show="alert.type === 'success'" fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                <!-- Warning Icon -->
                                <path x-show="alert.type === 'warning'" fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                <!-- Info Icon -->
                                <path x-show="alert.type === 'info'" fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                        </div>

                        <!-- Alert Message -->
                        <div class="ml-3 flex-1">
                            <p class="text-sm font-medium"
                               :class="{
                                   'text-red-800': alert.type === 'error',
                                   'text-green-800': alert.type === 'success',
                                   'text-yellow-800': alert.type === 'warning',
                                   'text-blue-800': alert.type === 'info'
                               }"
                               x-text="alert.message">
                            </p>
                        </div>

                        <!-- Close Button -->
                        <div class="ml-auto pl-3">
                            <button @click="dismissAlert()"
                                    class="inline-flex rounded-md p-1.5 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"
                                    :class="{
                                        'text-red-500 hover:bg-red-100 focus:ring-red-600': alert.type === 'error',
                                        'text-green-500 hover:bg-green-100 focus:ring-green-600': alert.type === 'success',
                                        'text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600': alert.type === 'warning',
                                        'text-blue-500 hover:bg-blue-100 focus:ring-blue-600': alert.type === 'info'
                                    }">
                                <span class="sr-only">Dismiss</span>
                                <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Page Content -->
                {% block content %}{% endblock %}

            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-12">
            <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-sm text-gray-500 mb-4 md:mb-0">
                        Â© 2025 Programming Course. All rights reserved.
                    </p>
                    <div class="flex space-x-6 text-sm text-gray-500">
                        <a href="mailto:{{ config.CONTACT_EMAIL or 'info@jaribu.org' }}"
                           class="hover:text-blue-600 transition-colors">
                            Support
                        </a>
                        <a href="tel:+254711175616"
                           class="hover:text-blue-600 transition-colors">
                            Contact
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Base JavaScript Functions -->
    <script>
        // Base Alpine.js application
        function baseApp() {
            return {
                // Global alert system for AJAX responses
                alert: {
                    show: false,
                    type: 'info',
                    message: '',
                    timeout: null
                },

                // Show alert message
                showAlert(type, message, duration = 5000) {
                    // Clear any existing timeout
                    if (this.alert.timeout) {
                        clearTimeout(this.alert.timeout);
                    }

                    this.alert.type = type;
                    this.alert.message = message;
                    this.alert.show = true;

                    // Auto-dismiss after duration
                    if (duration > 0) {
                        this.alert.timeout = setTimeout(() => {
                            this.dismissAlert();
                        }, duration);
                    }
                },

                // Dismiss alert
                dismissAlert() {
                    this.alert.show = false;
                    if (this.alert.timeout) {
                        clearTimeout(this.alert.timeout);
                        this.alert.timeout = null;
                    }
                },

                // Get CSRF token for AJAX requests
                getCSRFToken() {
                    const metaTag = document.querySelector('meta[name="csrf-token"]');
                    return metaTag ? metaTag.getAttribute('content') : null;
                },

                // Generic AJAX helper
                async fetchWithCSRF(url, options = {}) {
                    const csrfToken = this.getCSRFToken();

                    const defaultOptions = {
                        headers: {
                            'Content-Type': 'application/json',
                            ...(csrfToken && { 'X-CSRFToken': csrfToken })
                        }
                    };

                    const mergedOptions = {
                        ...defaultOptions,
                        ...options,
                        headers: {
                            ...defaultOptions.headers,
                            ...options.headers
                        }
                    };

                    try {
                        const response = await fetch(url, mergedOptions);

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        return response;
                    } catch (error) {
                        console.error('AJAX request failed:', error);
                        this.showAlert('error', 'Network error. Please try again.');
                        throw error;
                    }
                }
            }
        }

        // Flash message handler
        function flashMessages() {
            return {
                showMessage: true,

                init() {
                    // Auto-dismiss flash messages after 5 seconds
                    setTimeout(() => {
                        this.showMessage = false;
                    }, 5000);
                },

                dismissMessage() {
                    this.showMessage = false;
                }
            }
        }

        // Form validation helpers
        function formValidation() {
            return {
                errors: {},

                validateEmail(email) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return emailRegex.test(email);
                },

                validatePhone(phone) {
                    const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
                    return phoneRegex.test(phone.replace(/[\s\-\(\)]/g, ''));
                },

                addError(field, message) {
                    if (!this.errors[field]) {
                        this.errors[field] = [];
                    }
                    this.errors[field].push(message);
                },

                clearError(field) {
                    delete this.errors[field];
                },

                hasErrors() {
                    return Object.keys(this.errors).length > 0;
                },

                getError(field) {
                    return this.errors[field] ? this.errors[field][0] : null;
                }
            }
        }

        // File upload helper
        function fileUpload(maxSize = 5 * 1024 * 1024, allowedTypes = ['image/png', 'image/jpeg', 'application/pdf']) {
            return {
                fileName: '',
                fileSize: '',
                error: '',
                uploading: false,

                handleFileSelect(event) {
                    const file = event.target.files[0];
                    this.error = '';

                    if (!file) {
                        this.fileName = '';
                        this.fileSize = '';
                        return;
                    }

                    // Validate file size
                    if (file.size > maxSize) {
                        this.error = `File size must be less than ${this.formatFileSize(maxSize)}`;
                        event.target.value = '';
                        return;
                    }

                    // Validate file type
                    if (!allowedTypes.includes(file.type)) {
                        this.error = `File type not allowed. Please upload: ${allowedTypes.map(type => type.split('/')[1]).join(', ')}`;
                        event.target.value = '';
                        return;
                    }

                    this.fileName = file.name;
                    this.fileSize = this.formatFileSize(file.size);
                },

                formatFileSize(bytes) {
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    if (bytes === 0) return '0 Bytes';
                    const i = Math.floor(Math.log(bytes) / Math.log(1024));
                    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
                }
            }
        }
    </script>

    <!-- Additional JavaScript -->
    {% block extra_js %}{% endblock %}
</body>
</html>
