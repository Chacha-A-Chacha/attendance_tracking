{% extends "enrollment_base.html" %}

{% block title %}Apply Now - Programming Course{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8 text-center">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Apply for Programming Course</h1>
    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Join our comprehensive programming course and start your journey into software development.
        Please fill out all sections below to complete your application.
    </p>
    <div class="mt-4 text-sm text-blue-600">
        <span class="font-medium">Application Fee Required:</span> Complete payment information needed to process your application
    </div>
</div>

<!-- Form Validation Errors -->
{% if form.errors %}
    <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-md">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm/6 font-medium text-red-800">
                    Please correct the following errors:
                </h3>
                <div class="mt-2 text-sm/6 text-red-700">
                    <ul class="list-disc list-inside space-y-1">
                        {% for field_name, errors in form.errors.items() %}
                            {% for error in errors %}
                                <li>{{ form[field_name].label.text }}: {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<!-- Enrollment Form -->
<form method="POST"
      action="{{ url_for('enrollment.create_enrollment') }}"
      enctype="multipart/form-data"
      x-data="enrollmentForm()"
      @submit="handleSubmit">

    {{ form.hidden_tag() }}

    <div class="space-y-12">

        <!-- Personal Information Section -->
        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-base/7 font-semibold text-gray-900">Personal Information</h2>
            <p class="mt-1 text-sm/6 text-gray-600">Please provide your full legal name as it appears on your identification.</p>

            <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                <!-- First Name -->
                <div class="sm:col-span-2">
                    <label for="{{ form.first_name.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.first_name.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        {{ form.first_name(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                            autocomplete="given-name") }}
                    </div>
                    {% if form.first_name.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.first_name.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Second Name -->
                <div class="sm:col-span-2">
                    <label for="{{ form.second_name.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.second_name.label.text }}
                    </label>
                    <div class="mt-2">
                        {{ form.second_name(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                            autocomplete="additional-name") }}
                    </div>
                    {% if form.second_name.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.second_name.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Surname -->
                <div class="sm:col-span-2">
                    <label for="{{ form.surname.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.surname.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        {{ form.surname(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                            autocomplete="family-name") }}
                    </div>
                    {% if form.surname.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.surname.errors[0] }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-base/7 font-semibold text-gray-900">Contact Information</h2>
            <p class="mt-1 text-sm/6 text-gray-600">We'll use this information to communicate with you throughout the course.</p>

            <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                <!-- Email Address -->
                <div class="sm:col-span-4">
                    <label for="{{ form.email.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.email.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        {{ form.email(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                            autocomplete="email",
                            **{'x-model': 'formData.email', '@blur': 'checkEmailAvailability()'}) }}
                    </div>

                    <!-- Email availability feedback -->
                    <div x-show="emailCheckMessage" class="mt-2 text-sm/6"
                         :class="{
                             'text-red-600': !emailAvailable && emailAvailable !== null,
                             'text-green-600': emailAvailable,
                             'text-gray-600': emailAvailable === null
                         }">
                        <span x-text="emailCheckMessage"></span>
                    </div>

                    {% if form.email.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.email.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Phone Number -->
                <div class="sm:col-span-2">
                    <label for="{{ form.phone.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.phone.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        {{ form.phone(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                            autocomplete="tel") }}
                    </div>
                    {% if form.phone.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.phone.errors[0] }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Learning Resources Section -->
        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-base/7 font-semibold text-gray-900">Learning Resources</h2>
            <p class="mt-1 text-sm/6 text-gray-600">Help us understand your equipment needs for the course.</p>

            <div class="mt-10 space-y-10">
                <!-- Has Laptop -->
                <div>
                    <label class="block text-sm/6 font-medium text-gray-900">
                        {{ form.has_laptop.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-6 space-y-6">
                        {% for value, label in form.has_laptop.choices %}
                            <div class="flex items-center gap-x-3">
                                <input id="has_laptop_{{ value }}"
                                       type="radio"
                                       name="{{ form.has_laptop.name }}"
                                       value="{{ value }}"
                                       x-model="formData.hasLaptop"
                                       @change="handleLaptopChange()"
                                       {% if form.has_laptop.data == value %}checked{% endif %}
                                       {% if form.has_laptop.flags.required %}required{% endif %}
                                       class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white not-checked:before:hidden checked:border-blue-600 checked:bg-blue-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                                <label for="has_laptop_{{ value }}" class="block text-sm/6 font-medium text-gray-900">
                                    {{ label }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                    {% if form.has_laptop.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.has_laptop.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Laptop Details (conditional) -->
                <div x-show="formData.hasLaptop === 'yes'"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100"
                     class="grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-2">

                    <div>
                        <label for="{{ form.laptop_brand.id }}" class="block text-sm/6 font-medium text-gray-900">
                            {{ form.laptop_brand.label.text }}
                        </label>
                        <div class="mt-2">
                            {{ form.laptop_brand(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                                **{'x-model': 'formData.laptopBrand'}) }}
                        </div>
                        {% if form.laptop_brand.errors %}
                            <p class="mt-2 text-sm/6 text-red-600">{{ form.laptop_brand.errors[0] }}</p>
                        {% endif %}
                    </div>

                    <div>
                        <label for="{{ form.laptop_model.id }}" class="block text-sm/6 font-medium text-gray-900">
                            {{ form.laptop_model.label.text }}
                        </label>
                        <div class="mt-2">
                            {{ form.laptop_model(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6",
                                **{'x-model': 'formData.laptopModel'}) }}
                        </div>
                        {% if form.laptop_model.errors %}
                            <p class="mt-2 text-sm/6 text-red-600">{{ form.laptop_model.errors[0] }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Laptop Rental Option -->
                <div x-show="formData.hasLaptop === 'no'"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform scale-95"
                     x-transition:enter-end="opacity-100 transform scale-100">
                    <div class="flex gap-3">
                        <div class="flex h-6 shrink-0 items-center">
                            <div class="group grid size-4 grid-cols-1">
                                {{ form.needs_laptop_rental(class="col-start-1 row-start-1 appearance-none rounded-sm border border-gray-300 bg-white checked:border-blue-600 checked:bg-blue-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600") }}
                                <svg viewBox="0 0 14 14" fill="none" class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white group-has-disabled:stroke-gray-950/25">
                                    <path d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-0 group-has-checked:opacity-100" />
                                </svg>
                            </div>
                        </div>
                        <div class="text-sm/6">
                            {{ form.needs_laptop_rental.label(class="font-medium text-gray-900") }}
                            <p class="text-gray-500">We'll help you arrange laptop rental for the duration of the course (additional fee may apply).</p>
                            {% if form.needs_laptop_rental.errors %}
                                <p class="mt-2 text-sm/6 text-red-600">{{ form.needs_laptop_rental.errors[0] }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Information Section -->
        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-base/7 font-semibold text-gray-900">Payment Information</h2>
            <p class="mt-1 text-sm/6 text-gray-600">Please provide your payment details and upload a receipt to complete your application.</p>

            <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-2">
                <!-- Receipt Number -->
                <div>
                    <label for="{{ form.receipt_number.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.receipt_number.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        {{ form.receipt_number(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6") }}
                    </div>
                    {% if form.receipt_number.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.receipt_number.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Payment Amount -->
                <div>
                    <label for="{{ form.payment_amount.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.payment_amount.label.text }} <span class="text-red-500">*</span>
                    </label>
                    <div class="mt-2">
                        {{ form.payment_amount(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6") }}
                    </div>
                    {% if form.payment_amount.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.payment_amount.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Receipt Upload -->
                <div class="sm:col-span-2">
                    <label for="{{ form.receipt_file.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.receipt_file.label.text }} <span class="text-red-500">*</span>
                    </label>

                    <!-- Fixed file upload area with proper Alpine.js integration -->
                    <div class="mt-2"
                         x-data="fileUploadComponent()"
                         x-cloak>

                        <!-- File Drop Zone -->
                        <div class="flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10 transition-colors"
                             :class="{ 'border-blue-400 bg-blue-50': dragOver }"
                             @dragover.prevent="dragOver = true"
                             @dragleave.prevent="dragOver = false"
                             @drop.prevent="handleDrop($event)">

                            <div class="text-center w-full">
                                <!-- File Upload Icon -->
                                <svg viewBox="0 0 24 24" fill="currentColor" class="mx-auto size-12 text-gray-300">
                                    <path d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>

                                <!-- Upload Instructions -->
                                <p class="mt-4 flex justify-center text-sm/6 text-gray-600">
                                    <label for="{{ form.receipt_file.id }}"
                                           class="relative cursor-pointer rounded-md bg-transparent font-semibold text-blue-600 hover:text-blue-500">
                                        <span>Upload a file</span>
                                    </label>
                                    <span class="pl-1">or drag and drop</span>
                                </p>

                                <!-- File Input (moved outside label) -->
                                {{ form.receipt_file(
                                    class="sr-only",
                                    id=form.receipt_file.id,
                                    **{
                                        '@change': 'handleFileSelect($event)',
                                        'x-ref': 'fileInput',
                                        'accept': '.png,.jpg,.jpeg,.pdf,.webp'
                                    }
                                ) }}

                                <p class="text-xs/5 text-gray-600">PNG, JPG, PDF, WebP up to 5MB</p>

                                <!-- SUCCESS: File Selected Display -->
                                <div x-show="fileName"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 transform scale-95"
                                     x-transition:enter-end="opacity-100 transform scale-100"
                                     class="mt-4 p-3 bg-green-50 border border-green-200 rounded-md">

                                    <div class="flex items-center">
                                        <!-- Success Icon -->
                                        <svg class="h-5 w-5 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>

                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-green-800">
                                                <strong>Selected:</strong> <span x-text="fileName"></span>
                                            </p>
                                            <p class="text-sm text-green-600">
                                                <strong>Size:</strong> <span x-text="fileSize"></span>
                                            </p>
                                        </div>

                                        <!-- Remove File Button -->
                                        <button type="button"
                                                @click="removeFile()"
                                                class="ml-2 inline-flex items-center p-1 border border-transparent rounded-full text-green-400 hover:text-green-600 focus:outline-none focus:ring-2 focus:ring-green-500">
                                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <!-- ERROR: File Validation Error Display -->
                                <div x-show="error"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 transform scale-95"
                                     x-transition:enter-end="opacity-100 transform scale-100"
                                     class="mt-4 p-3 bg-red-50 border border-red-200 rounded-md">

                                    <div class="flex items-center">
                                        <!-- Error Icon -->
                                        <svg class="h-5 w-5 text-red-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>

                                        <p class="text-sm font-medium text-red-800" x-text="error"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Server-side validation errors -->
                    {% if form.receipt_file.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.receipt_file.errors[0] }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Additional Information Section -->
        <div>
            <h2 class="text-base/7 font-semibold text-gray-900">Additional Information</h2>
            <p class="mt-1 text-sm/6 text-gray-600">Help us better understand your needs and background.</p>

            <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-2">
                <!-- Emergency Contact -->
                <div>
                    <label for="{{ form.emergency_contact.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.emergency_contact.label.text }}
                    </label>
                    <div class="mt-2">
                        {{ form.emergency_contact(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6") }}
                    </div>
                    {% if form.emergency_contact.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.emergency_contact.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Emergency Phone -->
                <div>
                    <label for="{{ form.emergency_phone.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.emergency_phone.label.text }}
                    </label>
                    <div class="mt-2">
                        {{ form.emergency_phone(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6") }}
                    </div>
                    {% if form.emergency_phone.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.emergency_phone.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- How did you hear about us -->
                <div>
                    <label for="{{ form.how_did_you_hear.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.how_did_you_hear.label.text }}
                    </label>
                    <div class="mt-2 grid grid-cols-1">
                        {{ form.how_did_you_hear(class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-1.5 pr-8 pl-3 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6") }}
                        <svg viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end text-gray-500 sm:size-4">
                            <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                        </svg>
                    </div>
                    {% if form.how_did_you_hear.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.how_did_you_hear.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Previous Attendance -->
                <div>
                    <label class="block text-sm/6 font-medium text-gray-900">
                        {{ form.previous_attendance.label.text }}
                    </label>
                    <div class="mt-6 space-y-6">
                        {% for value, label in form.previous_attendance.choices %}
                            <div class="flex items-center gap-x-3">
                                <input id="previous_attendance_{{ value }}"
                                       type="radio"
                                       name="{{ form.previous_attendance.name }}"
                                       value="{{ value }}"
                                       {% if form.previous_attendance.data == value %}checked{% endif %}
                                       class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white not-checked:before:hidden checked:border-blue-600 checked:bg-blue-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                                <label for="previous_attendance_{{ value }}" class="block text-sm/6 font-medium text-gray-900">
                                    {{ label }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                    {% if form.previous_attendance.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.previous_attendance.errors[0] }}</p>
                    {% endif %}
                </div>

                <!-- Special Requirements -->
                <div class="sm:col-span-2">
                    <label for="{{ form.special_requirements.id }}" class="block text-sm/6 font-medium text-gray-900">
                        {{ form.special_requirements.label.text }}
                    </label>
                    <div class="mt-2">
                        {{ form.special_requirements(class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6") }}
                    </div>
                    <p class="mt-3 text-sm/6 text-gray-600">Please describe any special requirements, disabilities, or accommodations you need for the course.</p>
                    {% if form.special_requirements.errors %}
                        <p class="mt-2 text-sm/6 text-red-600">{{ form.special_requirements.errors[0] }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="mt-6 flex items-center justify-end gap-x-6">
        <a href="{{ url_for('enrollment.search_application') }}"
           class="text-sm/6 font-semibold text-gray-900">
            Search Existing Application
        </a>

        <button type="submit"
                class="rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-blue-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                :disabled="submitting">
            <span x-show="!submitting">Submit Application</span>
            <span x-show="submitting" class="flex items-center">
                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Submitting...
            </span>
        </button>
    </div>

    <p class="mt-6 text-xs/5 text-gray-600 text-center">
        By submitting this application, you agree to our terms and conditions.
        All information provided will be kept confidential.
    </p>
</form>
{% endblock %}

{% block extra_js %}
<script>
// Enrollment form specific Alpine.js component
function enrollmentForm() {
    return {
        submitting: false,
        formData: {
            hasLaptop: '{{ form.has_laptop.data or "" }}',
            laptopBrand: '{{ form.laptop_brand.data or "" }}',
            laptopModel: '{{ form.laptop_model.data or "" }}',
            email: '{{ form.email.data or "" }}'
        },
        emailAvailable: null,
        emailCheckMessage: '',

        handleSubmit(event) {
            this.submitting = true;
            // Form will submit normally, this just handles UI state
        },

        handleLaptopChange() {
            if (this.formData.hasLaptop === 'no') {
                this.formData.laptopBrand = '';
                this.formData.laptopModel = '';
                // Clear the form fields
                const brandField = document.getElementById('laptop_brand');
                const modelField = document.getElementById('laptop_model');
                if (brandField) brandField.value = '';
                if (modelField) modelField.value = '';
            }
        },

        async checkEmailAvailability() {
            if (!this.formData.email || !this.validateEmail(this.formData.email)) {
                this.emailCheckMessage = '';
                this.emailAvailable = null;
                return;
            }

            try {
                const response = await this.fetchWithCSRF('{{ url_for("enrollment.check_email") }}', {
                    method: 'POST',
                    body: JSON.stringify({ email: this.formData.email })
                });

                const result = await response.json();

                if (result.exists) {
                    this.emailAvailable = false;
                    if (result.type === 'enrollment') {
                        this.emailCheckMessage = `Email already has application #${result.application_number}`;
                    } else {
                        this.emailCheckMessage = result.message;
                    }
                } else {
                    this.emailAvailable = true;
                    this.emailCheckMessage = 'Email is available';
                }
            } catch (error) {
                console.error('Email check failed:', error);
                this.emailCheckMessage = 'Unable to verify email availability';
                this.emailAvailable = null;
            }
        },

        validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
    }
}

// File Upload Component - Fixed Version
function fileUploadComponent() {
    return {
        fileName: '',
        fileSize: '',
        error: '',
        dragOver: false,
        maxSize: 5 * 1024 * 1024, // 5MB
        allowedTypes: ['image/png', 'image/jpeg', 'image/jpg', 'image/webp', 'application/pdf'],

        init() {
            // Initialize component
            console.log('File upload component initialized');
        },

        handleFileSelect(event) {
            const file = event.target.files[0];
            this.processFile(file);
        },

        handleDrop(event) {
            this.dragOver = false;
            const file = event.dataTransfer.files[0];
            if (file) {
                // Set the file to the input element
                const fileInput = this.$refs.fileInput;
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;

                this.processFile(file);
            }
        },

        processFile(file) {
            // Clear previous state
            this.error = '';
            this.fileName = '';
            this.fileSize = '';

            if (!file) {
                return;
            }

            // Validate file size
            if (file.size > this.maxSize) {
                this.error = `File size must be less than ${this.formatFileSize(this.maxSize)}`;
                this.clearFileInput();
                return;
            }

            // Validate file type
            if (!this.allowedTypes.includes(file.type)) {
                const allowedExts = this.allowedTypes.map(type => type.split('/')[1]).join(', ');
                this.error = `File type not allowed. Please upload: ${allowedExts}`;
                this.clearFileInput();
                return;
            }

            // File is valid - show success feedback
            this.fileName = file.name;
            this.fileSize = this.formatFileSize(file.size);

            console.log('File selected:', this.fileName, this.fileSize);
        },

        removeFile() {
            this.fileName = '';
            this.fileSize = '';
            this.error = '';
            this.clearFileInput();
        },

        clearFileInput() {
            const fileInput = this.$refs.fileInput;
            if (fileInput) {
                fileInput.value = '';
            }
        },

        formatFileSize(bytes) {
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 Bytes';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }
    }
}

</script>


{% endblock %}
