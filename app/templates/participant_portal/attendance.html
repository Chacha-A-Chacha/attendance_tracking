{% extends "enrollment_base.html" %}

{% block title %}Attendance Records - Programming Course{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Attendance Records</h1>
                    <p class="text-gray-600">View your attendance history and track your progress</p>
                </div>
                <a href="{{ url_for('participant_portal.dashboard') }}"
                   class="inline-flex items-center text-blue-600 hover:text-blue-500 font-medium">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L4.414 9H17a1 1 0 110 2H4.414l5.293 5.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="flex justify-center items-center py-12">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <span class="ml-2 text-gray-600">Loading attendance data...</span>
        </div>

        <!-- Main Content (Hidden until loaded) -->
        <div id="attendanceContent" class="hidden">

            <!-- Top Section: Calendar and Issues Side by Side -->
            <div class="md:grid md:grid-cols-2 md:divide-x md:divide-gray-200 bg-white rounded-lg shadow-md mb-8">

                <!-- Calendar Section -->
                <div class="md:pr-6 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-medium text-gray-900">Attendance Calendar</h2>
                        <div class="flex items-center space-x-2">
                            <button id="prevMonth" type="button" class="-my-1.5 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500">
                                <span class="sr-only">Previous month</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                    <path d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>
                            </button>
                            <h3 id="currentMonth" class="flex-auto text-sm font-semibold text-gray-900">January 2024</h3>
                            <button id="nextMonth" type="button" class="-my-1.5 -mr-1.5 ml-2 flex flex-none items-center justify-center p-1.5 text-gray-400 hover:text-gray-500">
                                <span class="sr-only">Next month</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                                    <path d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="mt-4 grid grid-cols-7 text-center text-xs/6 text-gray-500">
                        <div>M</div>
                        <div>T</div>
                        <div>W</div>
                        <div>T</div>
                        <div>F</div>
                        <div>S</div>
                        <div>S</div>
                    </div>
                    <div id="calendarGrid" class="mt-2 grid grid-cols-7 text-sm">
                        <!-- Calendar dates will be populated here -->
                    </div>

                    <!-- Calendar Legend -->
                    <div class="mt-4 flex flex-wrap items-center justify-center gap-4 text-xs">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded-full mr-1"></div>
                            <span class="text-gray-600">Present</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>
                            <span class="text-gray-600">Absent</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-500 rounded-full mr-1"></div>
                            <span class="text-gray-600">Wrong Session</span>
                        </div>
                    </div>
                </div>

                <!-- Issues Section -->
                <div class="md:pl-6 p-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Attendance Issues</h2>

                    <!-- Stats Summary -->
                    <div id="attendanceStats" class="grid grid-cols-2 gap-4 mb-6">
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div id="attendanceRate" class="text-xl font-bold text-green-600">-</div>
                            <div class="text-xs text-gray-600">Attendance Rate</div>
                        </div>
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div id="correctSessionRate" class="text-xl font-bold text-blue-600">-</div>
                            <div class="text-xs text-gray-600">Correct Sessions</div>
                        </div>
                    </div>

                    <!-- Issues List -->
                    <div id="issuesList" class="space-y-3">
                        <!-- Issues will be populated here -->
                    </div>

                    <!-- No Issues State -->
                    <div id="noIssues" class="hidden text-center py-8">
                        <svg class="mx-auto h-12 w-12 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900">No Issues Found</h3>
                        <p class="mt-1 text-sm text-gray-500">Your attendance is on track!</p>
                    </div>
                </div>
            </div>

            <!-- Attendance Records Section -->
            <div class="bg-white rounded-lg shadow-md">

                <!-- Tab Navigation -->
                <div class="border-b border-gray-200">
                    <div class="px-6 py-4">
                        <h2 class="text-lg font-medium text-gray-900 mb-4">Attendance Records</h2>

                        <!-- Mobile Tab Select -->
                        <div class="grid grid-cols-1 sm:hidden">
                            <select id="mobileTabSelect" aria-label="Select a tab" class="col-start-1 row-start-1 w-full appearance-none rounded-md bg-white py-2 pr-8 pl-3 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600">
                                <option value="all">All Records</option>
                                <option value="saturday">Saturday Sessions</option>
                                <option value="sunday">Sunday Sessions</option>
                            </select>
                            <svg viewBox="0 0 16 16" fill="currentColor" data-slot="icon" aria-hidden="true" class="pointer-events-none col-start-1 row-start-1 mr-2 size-5 self-center justify-self-end fill-gray-500">
                                <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
                            </svg>
                        </div>

                        <!-- Desktop Tab Navigation -->
                        <div class="hidden sm:block">
                            <nav aria-label="Tabs" class="isolate flex divide-x divide-gray-200 rounded-lg bg-white shadow-sm">
                                <button class="tab-button group relative min-w-0 flex-1 overflow-hidden rounded-l-lg px-4 py-3 text-center text-sm font-medium text-gray-900 hover:bg-gray-50 focus:z-10" data-tab="all">
                                    <span>All Records</span>
                                    <span aria-hidden="true" class="absolute inset-x-0 bottom-0 h-0.5 bg-blue-500"></span>
                                </button>
                                <button class="tab-button group relative min-w-0 flex-1 overflow-hidden px-4 py-3 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10" data-tab="saturday">
                                    <span>Saturday Sessions</span>
                                    <span aria-hidden="true" class="absolute inset-x-0 bottom-0 h-0.5 bg-transparent"></span>
                                </button>
                                <button class="tab-button group relative min-w-0 flex-1 overflow-hidden rounded-r-lg px-4 py-3 text-center text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 focus:z-10" data-tab="sunday">
                                    <span>Sunday Sessions</span>
                                    <span aria-hidden="true" class="absolute inset-x-0 bottom-0 h-0.5 bg-transparent"></span>
                                </button>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Records Content -->
                <div class="p-6">
                    <!-- Records Loading -->
                    <div id="recordsLoading" class="hidden text-center py-8">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"></div>
                        <span class="mt-2 text-sm text-gray-600">Loading records...</span>
                    </div>

                    <!-- Records Table -->
                    <div id="recordsTable" class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Day</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Session</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Session Status</th>
                                </tr>
                            </thead>
                            <tbody id="recordsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Records will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- No Records State -->
                    <div id="noRecords" class="hidden text-center py-12">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900">No Records Found</h3>
                        <p class="mt-1 text-sm text-gray-500">No attendance records for the selected filter.</p>
                    </div>

                    <!-- Pagination -->
                    <div id="pagination" class="hidden mt-6 flex items-center justify-between">
                        <div class="flex items-center text-sm text-gray-700">
                            Showing <span id="recordsStart">1</span> to <span id="recordsEnd">20</span> of <span id="recordsTotal">100</span> results
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="prevPage" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50" disabled>
                                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <span id="pageInfo" class="px-3 py-2 text-sm text-gray-700">Page 1 of 5</span>
                            <button id="nextPage" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50">
                                <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// State management
let currentDate = new Date();
let currentTab = 'all';
let currentPage = 1;
let attendanceData = {};
let calendarData = {};

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    initializeEventListeners();
    loadAttendanceData();
});

// Event listeners
function initializeEventListeners() {
    // Calendar navigation
    document.getElementById('prevMonth').addEventListener('click', () => navigateMonth(-1));
    document.getElementById('nextMonth').addEventListener('click', () => navigateMonth(1));

    // Tab navigation
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', (e) => switchTab(e.target.dataset.tab));
    });

    // Mobile tab select
    document.getElementById('mobileTabSelect').addEventListener('change', (e) => {
        switchTab(e.target.value);
    });

    // Pagination
    document.getElementById('prevPage').addEventListener('click', () => navigatePage(-1));
    document.getElementById('nextPage').addEventListener('click', () => navigatePage(1));
}

// Load all attendance data
async function loadAttendanceData() {
    try {
        // Load summary, issues, and calendar data in parallel
        const [summaryResponse, issuesResponse, calendarResponse] = await Promise.all([
            fetchWithCSRF('/portal/api/attendance/summary'),
            fetchWithCSRF('/portal/api/attendance/issues'),
            fetchWithCSRF(`/portal/api/attendance/calendar-data?month=${currentDate.getMonth() + 1}&year=${currentDate.getFullYear()}`)
        ]);

        const [summary, issues, calendar] = await Promise.all([
            summaryResponse.json(),
            issuesResponse.json(),
            calendarResponse.json()
        ]);

        // Update display
        if (summary.success) {
            updateStats(summary.statistics);
        }

        if (issues.success) {
            updateIssues(issues.issues);
        }

        if (calendar.success) {
            calendarData = calendar;
            updateCalendar();
        }

        // Load attendance records
        loadAttendanceRecords();

    } catch (error) {
        console.error('Failed to load attendance data:', error);
        showAlert('Failed to load attendance data', 'error');
    } finally {
        document.getElementById('loadingState').classList.add('hidden');
        document.getElementById('attendanceContent').classList.remove('hidden');
    }
}

// Update statistics display
function updateStats(stats) {
    document.getElementById('attendanceRate').textContent = stats.attendance_rate + '%';
    document.getElementById('correctSessionRate').textContent = stats.correct_session_rate + '%';
}

// Update issues display
function updateIssues(issues) {
    const issuesList = document.getElementById('issuesList');
    const noIssues = document.getElementById('noIssues');

    if (issues.length === 0) {
        issuesList.classList.add('hidden');
        noIssues.classList.remove('hidden');
        return;
    }

    issuesList.classList.remove('hidden');
    noIssues.classList.add('hidden');

    issuesList.innerHTML = issues.map(issue => {
        const colorClass = issue.severity === 'danger' ? 'red' : 'yellow';
        return `
            <div class="flex items-start space-x-3 p-3 rounded-lg bg-${colorClass}-50 border border-${colorClass}-200">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-${colorClass}-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-${colorClass}-800">${issue.title}</p>
                    <p class="text-sm text-${colorClass}-700">${issue.message}</p>
                </div>
            </div>
        `;
    }).join('');
}

// Calendar functions
function navigateMonth(direction) {
    currentDate.setMonth(currentDate.getMonth() + direction);
    updateCalendarHeader();
    loadCalendarData();
}

function updateCalendarHeader() {
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    document.getElementById('currentMonth').textContent =
        `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
}

async function loadCalendarData() {
    try {
        const response = await fetchWithCSRF(
            `/portal/api/attendance/calendar-data?month=${currentDate.getMonth() + 1}&year=${currentDate.getFullYear()}`
        );
        const data = await response.json();

        if (data.success) {
            calendarData = data;
            updateCalendar();
        }
    } catch (error) {
        console.error('Failed to load calendar data:', error);
    }
}

function updateCalendar() {
    const calendarGrid = document.getElementById('calendarGrid');
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Convert to Monday = 0

    // Clear calendar
    calendarGrid.innerHTML = '';

    // Add empty cells for days before month starts
    for (let i = 0; i < startingDayOfWeek; i++) {
        const cell = createCalendarCell('', false, null);
        calendarGrid.appendChild(cell);
    }

    // Add days of month
    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayData = calendarData.calendar_data?.[dateStr] || [];
        const isToday = isDateToday(year, month, day);

        const cell = createCalendarCell(day, true, dayData, isToday);
        calendarGrid.appendChild(cell);
    }

    updateCalendarHeader();
}

function createCalendarCell(day, isCurrentMonth, dayData, isToday = false) {
    const cell = document.createElement('div');
    cell.className = `py-2 ${isCurrentMonth ? '' : 'text-gray-400'}`;

    if (day) {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `mx-auto flex size-8 items-center justify-center rounded-full text-sm relative`;

        // Base styling
        if (isCurrentMonth) {
            button.className += ' text-gray-900 hover:bg-gray-200';
        }

        // Today styling
        if (isToday) {
            button.className += ' font-semibold text-blue-600';
        }

        // Attendance indicator
        if (dayData && dayData.length > 0) {
            const hasPresent = dayData.some(d => d.status === 'present');
            const hasWrongSession = dayData.some(d => !d.is_correct_session && d.status === 'present');
            const hasAbsent = dayData.some(d => d.status === 'absent');

            if (hasPresent && !hasWrongSession) {
                button.className += ' bg-green-100 text-green-800';
            } else if (hasWrongSession) {
                button.className += ' bg-yellow-100 text-yellow-800';
            } else if (hasAbsent) {
                button.className += ' bg-red-100 text-red-800';
            }

            // Add indicator dot
            const indicator = document.createElement('span');
            indicator.className = 'absolute -top-1 -right-1 w-2 h-2 rounded-full';
            if (hasPresent && !hasWrongSession) {
                indicator.className += ' bg-green-500';
            } else if (hasWrongSession) {
                indicator.className += ' bg-yellow-500';
            } else if (hasAbsent) {
                indicator.className += ' bg-red-500';
            }
            button.appendChild(indicator);
        }

        button.innerHTML = `<time datetime="${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}">${day}</time>`;
        cell.appendChild(button);
    }

    return cell;
}

function isDateToday(year, month, day) {
    const today = new Date();
    return year === today.getFullYear() &&
           month === today.getMonth() &&
           day === today.getDate();
}

// Tab management
function switchTab(tab) {
    currentTab = tab;
    currentPage = 1;

    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        const isActive = button.dataset.tab === tab;
        const span = button.querySelector('span:last-child');

        if (isActive) {
            button.className = button.className.replace('text-gray-500', 'text-gray-900');
            span.className = span.className.replace('bg-transparent', 'bg-blue-500');
        } else {
            button.className = button.className.replace('text-gray-900', 'text-gray-500');
            span.className = span.className.replace('bg-blue-500', 'bg-transparent');
        }
    });

    // Update mobile select
    document.getElementById('mobileTabSelect').value = tab;

    // Load records for new tab
    loadAttendanceRecords();
}

// Load attendance records
async function loadAttendanceRecords() {
    showRecordsLoading(true);

    try {
        let url = `/portal/api/attendance/history?page=${currentPage}&limit=20`;

        // Add day filter if not 'all'
        if (currentTab !== 'all') {
            // We'll filter on the frontend since the API doesn't have day filtering
        }

        const response = await fetchWithCSRF(url);
        const data = await response.json();

        if (data.success) {
            // Filter records by day if needed
            let filteredRecords = data.records;
            if (currentTab !== 'all') {
                filteredRecords = data.records.filter(record =>
                    record.session.day.toLowerCase() === currentTab
                );
            }

            updateRecordsTable(filteredRecords);
            updatePagination(data.pagination);
        } else {
            showAlert('Failed to load attendance records', 'error');
        }
    } catch (error) {
        console.error('Failed to load records:', error);
        showAlert('Failed to load attendance records', 'error');
    } finally {
        showRecordsLoading(false);
    }
}

function updateRecordsTable(records) {
    const tbody = document.getElementById('recordsTableBody');
    const noRecords = document.getElementById('noRecords');
    const recordsTable = document.getElementById('recordsTable');

    if (records.length === 0) {
        recordsTable.classList.add('hidden');
        noRecords.classList.remove('hidden');
        return;
    }

    recordsTable.classList.remove('hidden');
    noRecords.classList.add('hidden');

    tbody.innerHTML = records.map(record => {
        const statusBadge = getStatusBadge(record.status);
        const sessionBadge = getSessionBadge(record.is_correct_session);

        return `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.date}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.session.day}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${record.session.time_slot}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.time}</td>
                <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap">${sessionBadge}</td>
            </tr>
        `;
    }).join('');
}

function getStatusBadge(status) {
    const badges = {
        'present': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Present</span>',
        'absent': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Absent</span>',
        'late': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Late</span>'
    };
    return badges[status] || status;
}

function getSessionBadge(isCorrect) {
    return isCorrect
        ? '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Correct</span>'
        : '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Wrong Session</span>';
}

function updatePagination(pagination) {
    const paginationDiv = document.getElementById('pagination');

    if (pagination.pages <= 1) {
        paginationDiv.classList.add('hidden');
        return;
    }

    paginationDiv.classList.remove('hidden');

    document.getElementById('recordsStart').textContent = ((pagination.page - 1) * pagination.limit) + 1;
    document.getElementById('recordsEnd').textContent = Math.min(pagination.page * pagination.limit, pagination.total);
    document.getElementById('recordsTotal').textContent = pagination.total;
    document.getElementById('pageInfo').textContent = `Page ${pagination.page} of ${pagination.pages}`;

    // Update button states
    document.getElementById('prevPage').disabled = pagination.page <= 1;
    document.getElementById('nextPage').disabled = pagination.page >= pagination.pages;
}

function navigatePage(direction) {
    currentPage += direction;
    loadAttendanceRecords();
}

function showRecordsLoading(show) {
    document.getElementById('recordsLoading').classList.toggle('hidden', !show);
    document.getElementById('recordsTable').classList.toggle('hidden', show);
    document.getElementById('noRecords').classList.add('hidden');
}

// Initialize calendar header on load
updateCalendarHeader();
</script>
{% endblock %}
